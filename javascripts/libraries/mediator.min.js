(function(g,h){"function"===typeof g.exports?g.exports.Mediator=h():"function"===typeof define&&define.amd?define("mediator-js",[],function(){g.Mediator=h();return g.Mediator()}):g.Mediator=h()})(this,function(){function g(b,a,c){if(!(this instanceof g))return new g(b,a,c);var d=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};this.id=d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d();this.fn=b;this.options=a;this.context=c;this.channel=null}function h(b,a){if(!(this instanceof
h))return new h(b);this.namespace=b||"";this._subscribers=[];this._channels=[];this._parent=a;this.stopped=!1}function f(){if(!(this instanceof f))return new f;this._channels=new h("")}g.prototype={update:function(b){b&&(this.fn=b.fn||this.fn,this.context=b.context||this.context,this.options=b.options||this.options,this.channel&&(this.options&&void 0!==this.options.priority)&&this.channel.setPriority(this.id,this.options.priority))}};h.prototype={addSubscriber:function(b,a,c){b=new g(b,a,c);a&&void 0!==
a.priority?(a.priority>>=0,0>a.priority&&(a.priority=0),a.priority>=this._subscribers.length&&(a.priority=this._subscribers.length-1),this._subscribers.splice(a.priority,0,b)):this._subscribers.push(b);b.channel=this;return b},stopPropagation:function(){this.stopped=!0},getSubscriber:function(b){var a=0,c=this._subscribers.length;a;for(c;a<c;a++)if(this._subscribers[a].id===b||this._subscribers[a].fn===b)return this._subscribers[a]},setPriority:function(b,a){var c=0,d=0,e,d=0;for(e=this._subscribers.length;d<
e&&!(this._subscribers[d].id===b||this._subscribers[d].fn===b);d++)c++;d=this._subscribers[c];e=this._subscribers.slice(0,c);c=this._subscribers.slice(c+1);this._subscribers=e.concat(c);this._subscribers.splice(a,0,d)},addChannel:function(b){this._channels[b]=new h((this.namespace?this.namespace+":":"")+b,this)},hasChannel:function(b){return this._channels.hasOwnProperty(b)},returnChannel:function(b){return this._channels[b]},removeSubscriber:function(b){var a=this._subscribers.length-1;if(b)for(a;0<=
a;a--){if(this._subscribers[a].fn===b||this._subscribers[a].id===b)this._subscribers[a].channel=null,this._subscribers.splice(a,1)}else this._subscribers=[]},publish:function(b){var a=0,c=this._subscribers.length,d=!1,e;a;for(c;a<c;a++)this.stopped||(e=this._subscribers[a],void 0!==e.options&&"function"===typeof e.options.predicate?e.options.predicate.apply(e.context,b)&&(e.fn.apply(e.context,b),d=!0):(e.fn.apply(e.context,b),d=!0)),d&&(e.options&&void 0!==e.options)&&(e.options.calls--,1>e.options.calls?
(this.removeSubscriber(e.id),c--,a--):e.update(e.options));this._parent&&this._parent.publish(b);this.stopped=!1}};f.prototype={getChannel:function(b){var a=this._channels,c=b.split(":"),d=0,e=c.length;if(""===b)return a;if(0<c.length){d;for(e;d<e;d++)a.hasChannel(c[d])||a.addChannel(c[d]),a=a.returnChannel(c[d])}return a},subscribe:function(b,a,c,d){b=this.getChannel(b);c=c||{};d=d||{};return b.addSubscriber(a,c,d)},once:function(b,a,c,d){c=c||{};c.calls=1;return this.subscribe(b,a,c,d)},getSubscriber:function(b,
a){return this.getChannel(a||"").getSubscriber(b)},remove:function(b,a){this.getChannel(b).removeSubscriber(a)},publish:function(b){var a=Array.prototype.slice.call(arguments,1),c=this.getChannel(b);a.push(c);this.getChannel(b).publish(a)}};f.prototype.on=f.prototype.subscribe;f.prototype.bind=f.prototype.subscribe;f.prototype.emit=f.prototype.publish;f.prototype.trigger=f.prototype.publish;f.prototype.off=f.prototype.remove;f.Channel=h;f.Subscriber=g;f.version="0.9.4";return f});